---
title: HTTPS
categories: ["网络"]
tags: ["HTTPS"]
toc: true
---

HTTP 的明文传输带来的问题，可能在传输过程中信息被窃取或者篡改，伪造，容易发生中间人攻击。
HTTP -> 安全层（SSL/TLS） -> 传输层 -> 网络层，其中安全层的作用是对发送的 HTTP 请求进行加密操作，以及对接收到的 HTTP 请求进行解密操作。

对称加密，非对称加密的优缺点，得到一个对称加密和非对称加密搭配使用的方式。
传输过程中使用对称加密传输数据，而对称加密所需的密钥则通过非对称加密传输。搭配数字证书，数字证书是向浏览器方明确服务器方的身份，以及提供公钥。

1. 浏览器端向服务端发送请求，包含对称加密套件列表 + 非对称加密套件列表 + client_random
2. 服务端接到请求后，向浏览器端发送选择的，对称加密套件 + 非对称加密套件 + service_random + 数字证书
3. 浏览器端接到响应，先验证数字证书，然后 client_random + service_random 生成 pre_master，用公钥加密 pre_master，再加浏览器确认，发送到服务端
4. 服务端接到请求先用私钥解密，得到 pre_master，服务器发送确认
5. 开始 client_random + service_random + premaster 生成的 master secret 加密的数据进行传输。

#### 数字证书是啥，有啥用？

为了验证服务器的身份呀，避免中间人攻击。所以这边的解决方法是通过第三方的认证机构(CA)生成一个数字证书来证明呀。

如何生成？

- 我们准备一套公钥和私钥，私钥自己留着。然后向 CA 机构提交，公钥、公司、站点等信息并等待认证，这个认证过程可能是收费的
- CA 通过线上、线下等多种渠道来验证我们所提供信息的真实性，如公司是否存在、企业是否合法、域名是否归属该企业等；
- 如果信息审核通过，CA 会向我们签发认证的数字证书，包含了公钥、组织信息、CA 的信息、有效时间、证书序列号等，这些信息都是明文的，同时包含一个 CA 生成的签名

首先 CA 使用 Hash 函数来计算我们提交的明文信息，并得出信息摘要；然后 CA 再使用它的私钥对信息摘要进行加密，加密后的密文就是 CA 颁给我们的数字签名。

通常情况下，操作系统中会内置信任的顶级 CA 的证书信息（包含公钥），如果这个 CA 链中没有找到浏览器内置的顶级的 CA，证书也会被判定非法。

内置 CA 对应的证书称为根证书，根证书是最权威的机构，它们自己为自己签名，我们把这称为自签名证书。

如何验证？

浏览器接收到数字证书之后，会对数字证书进行验证。首先浏览器读取证书中相关的明文信息，采用 CA 签名时相同的 Hash 函数来计算并得到信息摘要 A；然后再利用对应 CA 的公钥解密签名数据，得到信息摘要 B；对比信息摘要 A 和信息摘要 B，如果一致，则可以确认证书是合法的，即证明了这个服务器；同时浏览器还会验证证书相关的域名信息、有效时间等信息。

> PS: 没想到没修的信息安全的课，效果这么好，至今我还记得安全的基础概念（并不是因为老师很帅 🐶）
