---
title: 【JS基础】执行
categories: ["JavaScript"]
toc: true
---

JavaScript 执行主要分为两个阶段：

- 代码预编译阶段
- 代码执行阶段

代码预编译阶段

- 预编译阶段进行变量声明
- 预编译阶段变量声明进行提升，但是值为 undefined
- 预编译阶段所有非表达式的函数声明进行提升

```
foo(10)
function foo (num) {
    console.log(foo)
    foo = num;
    console.log(foo)
    var foo
}
console.log(foo)
foo = 1
console.log(foo)
// undefined
// 10
// 1
```

> 作用域在预编译阶段确定，但是作用域链是在执行上下文的创建阶段完全生成的。执行上下文包括了：变量对象、作用域链以及 this 的指向

预编译阶段创建变量对象(Variable Object, VO)，在执行阶段，变量对象转换为激活对象(Active Object)，即完成 VO -> AO

> 正常来讲，在函数执行完毕并出栈时，函数内局部变量在下一个垃圾回收节点会被回收，该函数对应的执行上下文将会被销毁，这也正是我们在外界无法访问函数内定义的变量的原因。也就是说，只有在函数执行时，相关函数可以访问该变量，该变量在预编译阶段进行创建，在执行阶段进行激活，在函数执行完毕后，相关上下文被销毁。

> 闭包： 函数嵌套函数时，内层函数引用了外层函数作用域下的变量，并且内层函数在全局环境下可访问，就形成了闭包。

浏览器的垃圾清除

- 标记清除
- 引用计数
